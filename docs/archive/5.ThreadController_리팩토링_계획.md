# ThreadController_리팩토링_계획

## 배경/문제
- ThreadController가 DTO/검증/인증/매핑/영속성 로직을 모두 포함해 파일이 비대해졌다.
- 동일한 매핑 로직이 여러 엔드포인트에 반복되어 유지보수가 어렵다.
- 인증 로직(requireUsername)이 컨트롤러마다 중복된다.

## 목표
- ThreadController를 얇게 만들고 서비스/매퍼/DTO로 책임을 분리한다.
- 매핑/검증/비즈니스 로직의 중복을 제거한다.
- 인증 처리 로직을 공통 컴포넌트로 분리한다.

## 범위
- 포함
  - ThreadController의 DTO 분리
  - ThreadController의 매핑 로직 분리(Mapper)
  - Thread 관련 비즈니스 로직을 서비스로 이동
  - 공통 인증 헬퍼 분리(requireUsername)
- 제외
  - 엔티티/레포지토리 구조 변경(이미 완료)
  - API 스펙 변경(요청/응답 포맷 유지)
  - 기능 추가(새 기능은 제외)

## 현재 동작 정리
- ThreadController 내에 ThreadSummary/ThreadDetail/EntryDetail 등의 DTO가 내장되어 있다.
- list/feed/search/get 등의 응답 매핑이 반복된다.
- 인증 검증 로직(requireUsername)이 컨트롤러 내부에 존재한다.

## 개선 방향
- 컨트롤러는 요청 바인딩/검증 후 서비스 호출만 수행한다.
- DTO는 api/dto 패키지로 이동한다.
- 매핑 로직은 api/mapper로 분리하고 재사용한다.
- 인증 헬퍼는 공용 컴포넌트로 분리하여 다른 컨트롤러에서도 사용한다.

## 단계별 계획
- 1단계: DTO 분리
  - ThreadController 내부 DTO를 `api/dto`로 이동
  - 완료 기준: ThreadController 내부 data class 제거
- 2단계: 매퍼 분리
  - `ThreadMapper`에 공통 변환 로직 집약
  - 완료 기준: ThreadController에서 매핑 중복 제거
- 3단계: 서비스 분리
  - `ThreadService`로 비즈니스 로직 이동
  - 완료 기준: 컨트롤러는 서비스 호출만 수행
- 4단계: 인증 헬퍼 분리
  - `AuthSupport` 또는 유사 클래스에 requireUsername 이관
  - 완료 기준: 컨트롤러에서 인증 유틸 호출
- 5단계: 정리/검증
  - API 응답 동일성 확인
  - 완료 기준: 주요 엔드포인트 동작 동일

## 리스크 및 대응
- 매퍼/서비스 분리 과정에서 응답 포맷이 바뀔 위험
  - 대응: DTO 구조를 유지하고 수동 테스트로 확인
- 인증 로직 분리 후 인증 실패 처리 변경 위험
  - 대응: 기존 예외 메시지/상태 유지

## 검증 계획
- list/feed/search/get API 응답이 기존과 동일한지 비교
- create/update/pin/unpin/hide/restore 동작 확인
- 인증 미설정 시 401 응답 유지 확인
