# 프론트 리팩토링 및 분리 계획

## 배경/문제
- HomePage와 ThreadDetailPage가 과도하게 비대해져서 상태/네트워크/UI/헬퍼가 한 파일에 몰려 있다.
- 동일한 헬퍼 로직(텍스트 음소거 처리, 제목 파생, textarea 자동 리사이즈, 하이라이트)이 여러 페이지에 중복된다.
- 카테고리 추가 UI와 뮤테이션이 여러 페이지에 산재되어 UX/검증/로딩 처리의 일관성이 떨어질 위험이 있다.
- 인증 상태 조회(fetchMe)가 여러 위치에서 반복 호출된다.

## 목표
- 페이지 컴포넌트는 흐름 조립과 데이터 연결만 담당하고, UI/로직을 재사용 가능한 단위로 분리한다.
- 공통 헬퍼와 훅을 lib/ 혹은 hooks/로 이동하여 중복을 제거한다.
- 카테고리 추가/선택 UI를 공통 컴포넌트로 통합해 일관된 UX를 제공한다.
- 인증 상태를 상위에서 단일 소스로 관리한다.

## 범위
- 포함: `frontend/src/routes/HomePage.tsx`, `frontend/src/routes/ThreadDetailPage.tsx`, `frontend/src/routes/ArchivePage.tsx`, `frontend/src/App.tsx`에서의 분리/리팩토링
- 포함: 공통 헬퍼/훅/컴포넌트 신규 파일 추가
- 제외: 디자인 변경, 기능 추가, API 스펙 변경, 테스트 프레임워크 도입

## 현재 동작 정리
- HomePage/ThreadDetailPage에 상태, react-query, 렌더링 로직이 집중됨.
- 동일한 헬퍼 함수가 각 페이지 내에 중복 정의됨.
- 카테고리 추가 UI 로직이 Home/ThreadDetail/Settings에 중복됨.
- App과 HomePage 모두에서 `fetchMe` 호출.

## 개선 방향
- 페이지는 “컴포즈(조합)” 역할을 유지하고, 세부 UI/로직은 분리한다.
- 공통 헬퍼는 `lib/`로 이동하여 재사용성을 높인다.
- react-query와 상태 조합은 페이지 전용 훅으로 분리한다.
- 반복 UI는 작은 컴포넌트로 분해하여 테스트/변경 용이성을 확보한다.

## 단계별 계획
- 단계 1: 공통 유틸/훅 분리
  - 변경: 텍스트 음소거, 제목 파생/본문 분리, highlightMatches, textarea auto-resize, entry depth 계산을 `frontend/src/lib` 또는 `frontend/src/hooks`로 이동
  - 완료 기준: HomePage/ThreadDetailPage/ArchivePage에 동일 로직 중복 없음
- 단계 2: HomePage 컴포넌트 분해
  - 변경: Composer, ThreadList, ThreadCard, EntryItem, CategoryPicker 등 단위로 분리
  - 완료 기준: HomePage 파일 크기 대폭 감소, 각 컴포넌트가 단일 책임 유지
- 단계 3: ThreadDetailPage 컴포넌트 분해
  - 변경: ThreadHeader, ThreadEditor, EntryList/EntryItem, ReplyComposer 분리
  - 완료 기준: ThreadDetailPage 파일 크기 대폭 감소, 재사용 가능한 컴포넌트 경계 확보
- 단계 4: 카테고리 추가 UI 통합
  - 변경: 카테고리 추가/선택 UI를 공통 컴포넌트로 통일
  - 완료 기준: Home/ThreadDetail/Settings에서 동일 컴포넌트 사용
- 단계 5: 인증 상태 단일화
  - 변경: App에서 auth 상태를 상위로 가져오고 하위에 전달
  - 완료 기준: `fetchMe` 호출은 단일 위치에서 수행

## 리스크 및 대응
- 리스크: 리팩토링 중 렌더링/상태 갱신 타이밍이 바뀌어 미묘한 UX 변화 발생
  - 대응: 단계별로 분리하고, 주요 UX 동작은 수동으로 확인
- 리스크: 컴포넌트 분리로 props drilling 증가
  - 대응: 필요한 최소 props만 전달하고, 공통 훅/컨텍스트 도입은 범위를 넘지 않게 유지

## 검증 계획
- 수동 검증
  - HomePage: 로그인/로그아웃, 글 작성/편집/숨김, 검색/필터, 카테고리 추가/선택
  - ThreadDetailPage: 스레드 수정/숨김, 엔트리 작성/편집/답글, 음소거 토글
  - ArchivePage: 검색/복원 동작
- 간단 확인
  - 콘솔 에러 없음
  - 주요 네비게이션 정상 동작
