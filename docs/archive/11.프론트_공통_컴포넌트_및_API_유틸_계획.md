# 프론트 공통 컴포넌트 및 API 유틸 계획

## 배경/문제
- ThreadDetailPage가 Entry/Reply 렌더링을 직접 담당해 중복 가능성이 있다.
- HomeFeed의 상태 액션이 한 객체에 섞여 가독성이 떨어진다.
- useThreadActions의 invalidateTargets가 여러 곳에서 반복된다.
- ThreadCard 내부 렌더가 길어 추가 분리가 필요하다.
- API 요청이 유사한 fetch 패턴을 반복한다.

## 목표
- Entry/Reply 렌더링을 공통 컴포넌트로 재사용한다.
- HomeFeed actions를 도메인별로 분리한다.
- invalidateTargets 상수를 도입해 중복을 줄인다.
- ThreadCard 내부를 더 작게 쪼개어 유지보수성을 높인다.
- API 요청 공통 유틸을 도입해 에러/옵션 처리 중복을 제거한다.

## 범위
- 포함: `frontend/src/routes/ThreadDetailPage.tsx`, `frontend/src/components/home/*`, `frontend/src/hooks/useHomeFeedState.ts`, `frontend/src/hooks/useThreadActions.ts`, `frontend/src/lib/api.ts`
- 포함: 공통 컴포넌트/유틸 신규 추가
- 제외: 디자인 변경, 기능 추가, API 스펙 변경, 테스트 프레임워크 추가

## 현재 동작 정리
- ThreadDetailPage에서 Entry/Reply UI를 직접 렌더링한다.
- HomeFeed actions가 단일 객체로 노출된다.
- invalidateTargets 문자열 배열이 호출부에서 반복된다.
- ThreadCard가 여전히 큰 컴포넌트다.
- API 요청 시 fetch + credentials + 에러 처리 패턴이 반복된다.

## 개선 방향
- EntryCard/EntryEditor/ReplyComposer를 ThreadDetail에서도 공유하도록 올린다.
- HomeFeed actions를 thread/entry/reply 등으로 그룹화한다.
- invalidateTargets 상수를 `hooks` 혹은 `lib`에 정의해 공유한다.
- ThreadCard 내부를 Header/Body/Entries/Composer 단위로 분리한다.
- API 공통 함수로 fetch 설정과 에러 처리를 통일한다.

## 단계별 계획
- 단계 1: Entry/Reply 공통 컴포넌트 적용
  - 변경: ThreadDetailPage에서 EntryCard/EntryEditor/ReplyComposer 재사용
  - 완료 기준: Entry/Reply 렌더 로직 중복 제거
- 단계 2: HomeFeed actions 구조화
  - 변경: useHomeFeedState 반환을 도메인 그룹으로 분리
  - 완료 기준: HomeFeed 내 호출부 명확화
- 단계 3: invalidateTargets 상수화
  - 변경: 공통 상수 도입 후 호출부 치환
  - 완료 기준: 중복 문자열 제거
- 단계 4: ThreadCard 내부 분해
  - 변경: Header/Body/Entries/Composer 등 하위 컴포넌트 추가
  - 완료 기준: ThreadCard 파일 길이 축소
- 단계 5: API 공통 유틸 도입
  - 변경: 공통 fetch 래퍼 적용
  - 완료 기준: api.ts에서 중복 패턴 감소

## 리스크 및 대응
- 리스크: 공통 컴포넌트화로 props 복잡도 상승
  - 대응: 필요한 최소 props만 전달하고 타입 그룹화
- 리스크: API 유틸 도입 시 에러 메시지 변화
  - 대응: 기존 에러 메시지 형식을 유지

## 검증 계획
- 수동 검증
  - Home/ThreadDetail에서 Entry/Reply 작성/편집/숨김 동작 확인
  - 스레드/카테고리/검색/필터 동작 확인
- 간단 확인
  - 콘솔 에러 없음
  - 네비게이션 정상
