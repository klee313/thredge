# 카테고리_스레드_API_성능_개선_계획

## 배경/문제
- 특정 카테고리에 속하는 모든 스레드 목록을 조회하는 API 요청의 처리 속도가 느림
- 백엔드는 도커 컨테이너(thredge-backend-1)로 실행 중이며 실제 DB는 thredge-db-1 컨테이너에 있음
- 인덱스 설정과 쿼리 계획 최적화 여부를 확인할 필요가 있음

## 목표
- 해당 API의 평균 응답 시간을 유의미하게 개선
- DB 인덱스 및 쿼리 플랜 관점에서 병목을 식별하고 개선 포인트를 도출
- 개선안을 문서화하여 적용 여부를 결정할 수 있도록 함

## 범위
- 포함 범위
  - 해당 API 경로/핸들러/서비스/리포지토리의 쿼리 흐름 분석
  - DB 인덱스 현황 점검 및 쿼리 실행 계획 확인
  - 성능 개선 가능 지점 제안(인덱스/쿼리/캐싱/페이지네이션 등)
- 제외 범위
  - 대규모 아키텍처 변경(예: DB 분리, 캐시 레이어 신규 도입) 즉시 적용
  - 프론트엔드 변경

## 현재 동작 정리
- 백엔드가 카테고리 ID로 스레드 목록을 조회
- thredge-db-1에서 실제 쿼리가 수행됨
- 인덱스 유무 및 쿼리 플랜의 효율성이 불명확

## 개선 방향
- 실제 실행 쿼리와 실행 계획을 확인하여 병목 지점을 근거 기반으로 파악
- 필터/정렬/조인 조건에 맞는 인덱스 유효성 점검
- N+1, 불필요한 조인/필드 조회, 비정상적 스캔 여부 확인
- 필요 시 페이지네이션/부분 로딩/캐싱 전략 제안

## 단계별 계획
- Step 1: API 경로 및 쿼리 파악
  - 무엇을 변경: 해당 API의 핸들러/서비스/리포지토리에서 실제 실행 쿼리와 파라미터 확인
  - 완료 기준: 어떤 테이블/컬럼을 기준으로 필터링/정렬/조인하는지 정리
- Step 2: DB 인덱스 및 실행 계획 확인
  - 무엇을 변경: 인덱스 현황 조회 및 대표 쿼리의 EXPLAIN/ANALYZE 수행
  - 완료 기준: 병목 구간(Seq Scan, 높은 비용 정렬 등)과 인덱스 적합성 판단
- Step 3: 개선안 도출
  - 무엇을 변경: 필요한 인덱스 추가/쿼리 변경/조회 컬럼 최소화/페이지네이션 제안
  - 완료 기준: 적용 후보와 기대 효과를 정리한 개선안 목록 작성
- Step 4: 사용자 리뷰 후 적용 여부 결정
  - 무엇을 변경: 사용자 검토 요청 및 반영
  - 완료 기준: 적용할 개선안 확정

## 리스크 및 대응
- 인덱스 추가로 쓰기 성능 저하 가능
  - 대응: 사용 패턴 및 트래픽 고려, 부분 인덱스/복합 인덱스 신중 적용
- 쿼리 변경 시 결과 정합성 이슈
  - 대응: 변경 전후 결과 비교 및 샘플 데이터 검증

## 검증 계획
- 대표 카테고리로 API 호출 전/후 응답 시간 비교
- DB 실행 계획의 비용 감소 및 인덱스 사용 여부 확인
- 기본 기능 회귀 테스트(정렬/필터 결과 동일성 확인)
